<!DOCTYPE html>
<html>
<head>
    <title>Mobitec Barcode Generator</title>
    <link rel="manifest" href="manifest-tools.json">
    <link rel="apple-touch-icon" href="icons/apple-icon-180.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        /* --- CSS - Based on your original styles --- */
        body {
            font-family: Arial, sans-serif; /* Your original font */
            margin: 0;
            padding-top: 20px; /* Add space at the very top */
            text-align: center;
        }

        /* Original visibility logic - ADD .input-container here */
        h1, .input-container, #errorMessage, #barcodeContainer, #simplicityIndex, #explanation {
           visibility: hidden; /* Hide initially, but keep space */
        }

        .loading-message {
            font-size: 18px; /* Your original size */
            color: #007BFF; /* Your original color */
            margin: 0 0 20px 0; /* Bottom margin for spacing */
        }

        /* Original visibility logic - ADD .content-visible .input-container here */
        .content-visible h1,
        .content-visible .input-container,
        .content-visible #errorMessage,
        .content-visible #barcodeContainer,
        .content-visible #simplicityIndex,
        .content-visible #explanation {
            visibility: visible; /* Make visible when body gets class */
        }

        /* Modified .input-container for centering */
        .input-container {
            /* REMOVED width: 100%; */
            display: inline-block; /* ADDED: Allows centering via text-align */
            background-color: #f9f9f9; /* Your original background */
            border-bottom: 1px solid #ddd; /* Your original border */
            padding: 10px 15px; /* Adjusted padding slightly */
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1); /* Your original shadow */
            margin-bottom: 20px; /* ADDED: Space below container */
            text-align: left; /* ADDED: Align label/input left within the centered block */
            /* visibility handled by rules above */
        }

        /* Style label for better spacing */
        .input-container label {
             margin-right: 5px;
        }

        /* Original input styles */
        .input-container input {
            font-size: 16px;
            padding: 10px;
            margin: 5px; /* Your original margin */
            border: 1px solid #ccc; /* Added border for consistency */
            border-radius: 3px;
        }

        /* Original error message styles */
        #errorMessage {
            color: red;
            margin-top: 20px;
            min-height: 1.2em;
        }

        /* Original barcode styles */
        .barcode {
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            min-height: 260px;
            background-color: white; /* Added background for contrast */
            border: 1px solid #eee; /* Added border for contrast */
            padding: 5px 0;
        }

        /* Original bar styles */
        .bar {
            width: 70px;
            margin: 2px 0; /* Your original margin */
            flex-shrink: 0;
        }
         /* Add border to white bars for visibility */
         .bar[style*="background-color: white"] {
             border: 1px solid #eee;
             box-sizing: border-box;
         }

        /* Original small/thick bar styles */
        .small-bar {
            height: 20px;
        }

        .thick-bar {
            height: 40px;
        }

        /* Original info styles */
        #simplicityIndex, #explanation {
            margin-top: 20px;
            min-height: 1.2em;
        }
        #explanation {
             margin-top: 5px;
             font-style: italic;
        }
        /* --- END OF CSS --- */
    </style>
</head>
<body class=""> <div id="loadingMessage" class="loading-message">Self testing. Loading...</div>

    <div class="input-container">
        <label for="numberInput">Enter a number:</label>
        <input type="text" id="numberInput" inputmode="numeric" pattern="[0-9]*" placeholder="Enter 0-255 or 511" oninput="validateAndGenerate()" />
    </div>

    <h1>Mobitec Barcode Generator</h1>

    <div id="errorMessage"></div>
    <div class="barcode" id="barcodeContainer"></div>
    <div id="simplicityIndex"></div>
    <div id="explanation"></div>
    <audio id="audioPlayer" src="assets/Self Test copy.m4a" type="audio/mp4" preload="auto"></audio>

    <script>
        // --- EXACT ORIGINAL JAVASCRIPT for loading/audio logic ---
        const loadingMessage = document.getElementById("loadingMessage");
        const audioPlayer = document.getElementById("audioPlayer");

        function showMainContent() {
            // This is your original function body
            if (loadingMessage) loadingMessage.style.display = "none";
            document.body.classList.add('content-visible');
        }

        // Your original 5 second fallback timeout
        let loadingTimeout = setTimeout(showMainContent, 5000);

        // Your original audio handling block
        if (audioPlayer) {
            audioPlayer.addEventListener("canplaythrough", () => {
                // Your original logic inside canplaythrough
                clearTimeout(loadingTimeout);
                setTimeout(() => {
                    showMainContent();
                    audioPlayer.play().catch(e => console.error("Audio play failed:", e));
                }, 3000); // Your original 3 second delay
            });

            audioPlayer.addEventListener('error', (e) => {
                // Your original logic inside error handler
                console.error("Audio failed to load:", e);
                if (!document.body.classList.contains('content-visible')) {
                    clearTimeout(loadingTimeout);
                    loadingTimeout = setTimeout(showMainContent, 100); // Quick show on error
                 }
            });
            // NOTE: No explicit audioPlayer.load() here, matching your original code
        } else {
            // Your original fallback if audio player element isn't found
            console.log("Audio player element not found, using fallback timeout."); // This message was slightly inaccurate in your original, but kept for fidelity
            clearTimeout(loadingTimeout);
            loadingTimeout = setTimeout(showMainContent, 100); // Quick show
        }

        // --- Your other original JavaScript functions ---
        function validateAndGenerate() {
            const inputField = document.getElementById("numberInput");
            const nonNumericRegex = /[^0-9]/g;
            if (inputField) {
                 let value = inputField.value;
                 if (nonNumericRegex.test(value)) {
                     const start = inputField.selectionStart;
                     const end = inputField.selectionEnd;
                     const originalLength = value.length;
                     inputField.value = value.replace(nonNumericRegex, "");
                     const newLength = inputField.value.length;
                     const diff = originalLength - newLength;
                     if (diff > 0 && start !== null && end !== null) {
                         const newCursorPos = Math.max(0, start - diff);
                         setTimeout(() => { // Defer cursor update
                             inputField.setSelectionRange(newCursorPos, newCursorPos);
                         }, 0);
                     }
                 }
                 generateBarcode();
            }
        }

        const numberInputField = document.getElementById("numberInput");
        if (numberInputField) {
            numberInputField.addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                     event.preventDefault();
                    generateBarcode();
                     numberInputField.blur();
                }
            });
        }

        function generateBarcode() {
            const container = document.getElementById("barcodeContainer");
            const errorMessage = document.getElementById("errorMessage");
            const simplicityIndex = document.getElementById("simplicityIndex");
            const explanation = document.getElementById("explanation");
            const numberInput = document.getElementById("numberInput");

            if (!container || !errorMessage || !simplicityIndex || !explanation || !numberInput) { return; }

            const numberStr = numberInput.value;

            errorMessage.textContent = "";
            container.innerHTML = "";
            simplicityIndex.innerHTML = "";
            explanation.innerHTML = "";

            if (numberStr === "") { return; }

            const number = parseInt(numberStr, 10);

            if (isNaN(number) || number < 0 || (number > 255 && number !== 511)) {
                errorMessage.textContent = "Invalid number! Enter between 0â€“255, or 511.";
                return;
            }

            const binaryArray = number.toString(2).padStart(9, "0").split("");
            const reversedBinaryArray = [...binaryArray].reverse();

            addBar(container, "black", "thick-bar");
            reversedBinaryArray.forEach((bit) => {
                const colorClass = bit === "1" ? "black" : "white";
                addBar(container, colorClass, "small-bar");
            });
            addBar(container, "black", "small-bar");

            const simplicityScore = binaryArray.filter(bit => bit === "1").length;
            simplicityIndex.textContent = `Simplicity Index: ${simplicityScore}/9`;
            explanation.textContent = `Input: ${number} | Binary: ${binaryArray.join("")}`;
        }

        function addBar(container, color, sizeClass) {
            const bar = document.createElement("div");
            bar.className = `bar ${sizeClass}`;
            bar.style.backgroundColor = color === "black" ? "black" : "white";
            container.appendChild(bar);
        }

         window.addEventListener('load', () => {
            if (numberInputField && numberInputField.value) {
                const checkVisibility = () => {
                    if (document.body.classList.contains('content-visible')) { generateBarcode(); }
                    else { setTimeout(checkVisibility, 100); }
                };
                checkVisibility();
            }
         });
        // --- End of original JavaScript ---
    </script>

</body>
</html>
